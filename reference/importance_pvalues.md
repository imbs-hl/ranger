# ranger variable importance p-values

Compute variable importance with p-values. For high dimensional data,
the fast method of Janitza et al. (2016) can be used. The permutation
approach of Altmann et al. (2010) is computationally intensive but can
be used with all kinds of data. See below for details.

## Usage

``` r
importance_pvalues(
  x,
  method = c("janitza", "altmann"),
  num.permutations = 100,
  formula = NULL,
  data = NULL,
  ...
)
```

## Arguments

- x:

  `ranger` or `holdoutRF` object.

- method:

  Method to compute p-values. Use "janitza" for the method by Janitza et
  al. (2016) or "altmann" for the non-parametric method by Altmann et
  al. (2010).

- num.permutations:

  Number of permutations. Used in the "altmann" method only.

- formula:

  Object of class formula or character describing the model to fit. Used
  in the "altmann" method only.

- data:

  Training data of class data.frame or matrix. Used in the "altmann"
  method only.

- ...:

  Further arguments passed to
  [`ranger()`](http://imbs-hl.github.io/ranger/reference/ranger.md).
  Used in the "altmann" method only.

## Value

Variable importance and p-value for each variable.

## Details

The method of Janitza et al. (2016) uses a clever trick: With an
unbiased variable importance measure, the importance values of
non-associated variables vary randomly around zero. Thus, all
non-positive importance values are assumed to correspond to these
non-associated variables and they are used to construct a distribution
of the importance under the null hypothesis of no association to the
response. Since only the non-positive values of this distribution can be
observed, the positive values are created by mirroring the negative
distribution. See Janitza et al. (2016) for details.

The method of Altmann et al. (2010) uses a simple permutation test: The
distribution of the importance under the null hypothesis of no
association to the response is created by several replications of
permuting the response, growing an RF and computing the variable
importance. The authors recommend 50-100 permutations. However, much
larger numbers have to be used to estimate more precise p-values. We add
1 to the numerator and denominator to avoid zero p-values.

## References

Janitza, S., Celik, E. & Boulesteix, A.-L., (2016). A computationally
fast variable importance test for random forests for high-dimensional
data. Adv Data Anal Classif
[doi:10.1007/s11634-016-0276-4](https://doi.org/10.1007/s11634-016-0276-4)
.  
Altmann, A., Tolosi, L., Sander, O. & Lengauer, T. (2010). Permutation
importance: a corrected feature importance measure, Bioinformatics
26:1340-1347.

## See also

[`ranger`](http://imbs-hl.github.io/ranger/reference/ranger.md)

## Author

Marvin N. Wright

## Examples

``` r
## Janitza's p-values with corrected Gini importance
n <- 50
p <- 400
dat <- data.frame(y = factor(rbinom(n, 1, .5)), replicate(p, runif(n)))
rf.sim <- ranger(y ~ ., dat, importance = "impurity_corrected")
importance_pvalues(rf.sim, method = "janitza")
#>         importance     pvalue
#> X1    1.682494e-02 0.27832512
#> X2    3.657273e-02 0.14778325
#> X3    2.494746e-02 0.19211823
#> X4   -5.731536e-03 0.57389163
#> X5    2.596275e-02 0.18719212
#> X6    8.808176e-04 0.49014778
#> X7   -2.112857e-02 0.77093596
#> X8    4.069769e-02 0.12807882
#> X9   -1.764848e-02 0.72413793
#> X10   2.176364e-02 0.22660099
#> X11   8.457949e-03 0.39655172
#> X12   6.743129e-02 0.06403941
#> X13   4.623888e-02 0.10344828
#> X14  -1.013984e-02 0.63300493
#> X15   3.562793e-02 0.15024631
#> X16   5.776987e-02 0.07881773
#> X17   9.312368e-03 0.38669951
#> X18  -1.404231e-03 0.52216749
#> X19   8.267016e-05 0.49753695
#> X20   9.585714e-03 0.38423645
#> X21   7.661594e-02 0.05418719
#> X22   1.084900e-02 0.35714286
#> X23   2.300477e-02 0.21921182
#> X24   3.168067e-03 0.45320197
#> X25   1.931382e-02 0.25615764
#> X26   1.448279e-02 0.29802956
#> X27   1.534594e-03 0.47290640
#> X28   2.229115e-02 0.22167488
#> X29  -2.303556e-02 0.78325123
#> X30  -2.189892e-02 0.77832512
#> X31  -7.551710e-02 0.94581281
#> X32  -5.288504e-03 0.56650246
#> X33   6.274969e-02 0.07142857
#> X34  -1.242740e-03 0.51477833
#> X35   6.212889e-03 0.41625616
#> X36  -2.626871e-02 0.82019704
#> X37   3.548242e-02 0.15024631
#> X38  -1.186667e-02 0.65517241
#> X39   2.775182e-03 0.45812808
#> X40  -2.028692e-02 0.75369458
#> X41  -5.524399e-02 0.90886700
#> X42  -2.463423e-02 0.80541872
#> X43  -1.429214e-02 0.69950739
#> X44  -4.358584e-02 0.88423645
#> X45   2.434552e-03 0.46059113
#> X46   4.269980e-02 0.12068966
#> X47   3.963710e-02 0.13054187
#> X48   5.605907e-03 0.43103448
#> X49   8.509393e-02 0.04926108
#> X50  -7.471088e-02 0.94334975
#> X51   1.789768e-02 0.27093596
#> X52   2.219315e-02 0.22167488
#> X53  -2.386511e-01 1.00000000
#> X54  -1.002879e-02 0.62807882
#> X55   4.473882e-02 0.10837438
#> X56  -1.103457e-02 0.64532020
#> X57   5.646970e-03 0.43103448
#> X58  -2.085190e-02 0.76354680
#> X59  -1.269009e-02 0.66748768
#> X60  -2.461891e-02 0.80295567
#> X61   2.018809e-02 0.24876847
#> X62  -7.026087e-03 0.59605911
#> X63  -3.693539e-02 0.85467980
#> X64   9.069081e-02 0.04187192
#> X65  -2.410082e-02 0.79802956
#> X66   9.900000e-03 0.37684729
#> X67   5.978585e-03 0.42364532
#> X68  -1.480395e-02 0.70443350
#> X69  -3.838549e-02 0.86453202
#> X70   9.254119e-02 0.04187192
#> X71   1.970547e-02 0.25369458
#> X72  -3.029334e-03 0.54679803
#> X73  -1.140093e-02 0.65024631
#> X74  -1.270795e-03 0.51724138
#> X75  -8.814286e-03 0.61083744
#> X76  -2.606052e-02 0.81527094
#> X77  -1.929404e-03 0.53448276
#> X78  -5.677574e-02 0.91871921
#> X79   2.292319e-02 0.22167488
#> X80  -1.494143e-01 0.98275862
#> X81  -4.104727e-02 0.87438424
#> X82  -2.082857e-02 0.76108374
#> X83   3.307311e-02 0.15517241
#> X84   2.072469e-02 0.24384236
#> X85   4.831678e-03 0.43842365
#> X86  -6.192143e-03 0.58374384
#> X87  -7.627368e-03 0.60098522
#> X88   2.359595e-02 0.20935961
#> X89  -2.333547e-02 0.79064039
#> X90   1.413775e-02 0.30541872
#> X91  -8.600552e-02 0.95320197
#> X92  -5.885502e-03 0.57635468
#> X93  -1.070130e-02 0.64285714
#> X94  -1.386452e-02 0.69458128
#> X95  -3.800000e-03 0.55418719
#> X96  -6.388108e-02 0.93103448
#> X97  -8.311688e-04 0.50985222
#> X98   2.783450e-03 0.45812808
#> X99   4.873566e-03 0.43842365
#> X100  1.992635e-02 0.25123153
#> X101 -2.292437e-02 0.78078818
#> X102 -4.842148e-02 0.89901478
#> X103  8.271216e-02 0.04926108
#> X104 -1.019156e-02 0.63546798
#> X105 -2.473357e-02 0.80788177
#> X106  2.039161e-02 0.24630542
#> X107  8.515262e-02 0.04926108
#> X108  1.193306e-02 0.34482759
#> X109 -1.654946e-03 0.53201970
#> X110  6.427553e-02 0.06896552
#> X111 -4.425125e-02 0.88916256
#> X112  8.531857e-03 0.39655172
#> X113  1.650008e-02 0.28325123
#> X114 -3.251456e-03 0.54926108
#> X115  3.674051e-02 0.14778325
#> X116 -2.732265e-02 0.83497537
#> X117  1.057143e-02 0.36206897
#> X118 -1.983809e-01 0.99261084
#> X119  3.158235e-02 0.15517241
#> X120  1.947503e-02 0.25615764
#> X121  1.077147e-02 0.35714286
#> X122 -9.360000e-03 0.61576355
#> X123 -2.504942e-02 0.81034483
#> X124  9.414079e-04 0.49014778
#> X125  1.507999e-02 0.29064039
#> X126  4.642484e-03 0.43842365
#> X127  1.757210e-02 0.27832512
#> X128 -2.321591e-02 0.78817734
#> X129  3.810449e-02 0.13793103
#> X130 -1.116355e-02 0.64778325
#> X131  1.619585e-02 0.28571429
#> X132 -2.867299e-03 0.54433498
#> X133 -2.064501e-02 0.75615764
#> X134 -3.945633e-02 0.86945813
#> X135 -3.763149e-02 0.86206897
#> X136  3.494943e-02 0.15024631
#> X137  2.115515e-02 0.22906404
#> X138  2.755932e-02 0.16502463
#> X139 -3.759533e-02 0.85960591
#> X140  5.240761e-02 0.09605911
#> X141 -5.983415e-03 0.57881773
#> X142  1.565670e-02 0.28817734
#> X143  2.845358e-02 0.16256158
#> X144  7.040744e-03 0.40394089
#> X145  4.368282e-02 0.11576355
#> X146  1.506228e-02 0.29064039
#> X147 -2.309607e-02 0.78571429
#> X148  1.554575e-02 0.28817734
#> X149 -6.749624e-02 0.93842365
#> X150 -4.452606e-02 0.89162562
#> X151 -4.607915e-02 0.89655172
#> X152  3.960759e-03 0.44581281
#> X153 -1.009032e-02 0.63054187
#> X154 -9.277977e-03 0.61330049
#> X155 -1.559259e-01 0.98522167
#> X156  2.597691e-02 0.18719212
#> X157 -2.760549e-02 0.83743842
#> X158 -3.004783e-02 0.83990148
#> X159  1.875793e-02 0.25615764
#> X160  1.008288e-02 0.37192118
#> X161  1.251968e-02 0.33743842
#> X162  1.327870e-02 0.32266010
#> X163 -5.545487e-02 0.91625616
#> X164  1.766830e-02 0.27586207
#> X165 -2.729455e-02 0.83251232
#> X166  1.297706e-01 0.02955665
#> X167  5.048246e-03 0.43596059
#> X168 -1.008696e-01 0.96305419
#> X169  7.291082e-03 0.40147783
#> X170  3.895066e-03 0.44581281
#> X171  2.028743e-02 0.24630542
#> X172  8.695551e-02 0.04679803
#> X173  2.710403e-02 0.16995074
#> X174 -1.062967e-02 0.64039409
#> X175 -1.323111e-02 0.67733990
#> X176 -5.539483e-02 0.91379310
#> X177 -1.335913e-02 0.68226601
#> X178 -4.882289e-03 0.56403941
#> X179 -4.598437e-02 0.89408867
#> X180 -1.489247e-02 0.70935961
#> X181 -8.649340e-03 0.60837438
#> X182 -2.541229e-02 0.81280788
#> X183  3.977596e-02 0.13054187
#> X184  6.685569e-02 0.06403941
#> X185 -1.679205e-02 0.71921182
#> X186  7.028088e-02 0.06157635
#> X187 -1.322459e-01 0.97290640
#> X188 -8.247851e-02 0.95073892
#> X189 -5.426875e-02 0.90640394
#> X190 -1.100711e-01 0.96798030
#> X191  5.545139e-02 0.08620690
#> X192  1.029562e-02 0.36453202
#> X193 -1.354055e-02 0.68472906
#> X194 -1.717832e-01 0.99014778
#> X195  4.772260e-02 0.10344828
#> X196 -1.821698e-02 0.73645320
#> X197 -1.314103e-02 0.67487685
#> X198 -6.231274e-03 0.58620690
#> X199 -1.235767e-02 0.66009852
#> X200 -1.623512e-02 0.71674877
#> X201 -2.705636e-03 0.54187192
#> X202  7.184848e-03 0.40147783
#> X203 -1.364695e-02 0.68965517
#> X204 -9.027341e-02 0.95812808
#> X205 -2.634373e-02 0.82512315
#> X206 -3.697210e-02 0.85714286
#> X207 -2.110040e-03 0.53694581
#> X208  2.719212e-03 0.45812808
#> X209 -2.018717e-02 0.75123153
#> X210  1.158109e-02 0.34729064
#> X211 -6.142405e-02 0.92857143
#> X212 -8.203980e-02 0.94827586
#> X213 -2.100056e-02 0.76847291
#> X214 -2.617988e-02 0.81773399
#> X215  3.803783e-02 0.13793103
#> X216  1.156763e-02 0.34729064
#> X217 -2.348987e-03 0.53940887
#> X218  9.754690e-04 0.49014778
#> X219  5.541857e-02 0.08620690
#> X220 -2.424101e-02 0.80049261
#> X221 -5.502963e-03 0.56896552
#> X222 -1.342151e-01 0.97536946
#> X223 -1.620463e-03 0.52955665
#> X224  5.333333e-03 0.43349754
#> X225  9.407832e-03 0.38423645
#> X226  1.748881e-03 0.46798030
#> X227 -2.079249e-02 0.75862069
#> X228 -1.041079e-02 0.63793103
#> X229 -5.537702e-02 0.91133005
#> X230  1.354800e-02 0.31527094
#> X231 -2.634277e-02 0.82266010
#> X232  6.135895e-03 0.41871921
#> X233 -1.268554e-02 0.66502463
#> X234 -1.276043e-02 0.67241379
#> X235 -1.361778e-02 0.68719212
#> X236  1.012910e-02 0.36945813
#> X237  1.080696e-03 0.48768473
#> X238  8.090492e-03 0.39901478
#> X239 -9.987136e-03 0.62561576
#> X240 -2.188816e-02 0.77586207
#> X241 -2.380644e-02 0.79310345
#> X242  5.794745e-03 0.42610837
#> X243  5.155385e-03 0.43596059
#> X244 -1.518092e-03 0.52709360
#> X245 -2.406403e-02 0.79556650
#> X246 -5.774134e-02 0.92118227
#> X247  3.338892e-02 0.15517241
#> X248  2.597316e-02 0.18719212
#> X249  2.688895e-02 0.16995074
#> X250  1.888532e-02 0.25615764
#> X251  1.173117e-02 0.34729064
#> X252  3.454770e-02 0.15270936
#> X253 -2.649778e-02 0.82758621
#> X254 -2.084279e-01 0.99753695
#> X255  3.905244e-02 0.13300493
#> X256  1.305253e-02 0.32758621
#> X257 -1.804111e-02 0.73399015
#> X258 -1.272171e-02 0.66995074
#> X259  7.219127e-03 0.40147783
#> X260 -6.613954e-02 0.93596059
#> X261 -3.480239e-02 0.84975369
#> X262  1.661818e-02 0.28325123
#> X263 -8.536132e-03 0.60591133
#> X264 -5.698006e-06 0.50246305
#> X265 -1.866333e-02 0.74384236
#> X266  6.280804e-02 0.07142857
#> X267  6.222222e-03 0.41625616
#> X268 -3.407629e-02 0.84729064
#> X269  2.892450e-02 0.16256158
#> X270  1.927258e-02 0.25615764
#> X271 -2.154988e-02 0.77339901
#> X272 -6.634492e-03 0.58866995
#> X273  7.315267e-03 0.40147783
#> X274  1.855658e-02 0.25862069
#> X275 -1.840825e-02 0.73891626
#> X276 -1.289819e-03 0.51970443
#> X277  2.425108e-03 0.46059113
#> X278  4.101176e-03 0.44581281
#> X279 -5.020610e-02 0.90147783
#> X280 -1.387268e-01 0.97783251
#> X281  7.642075e-02 0.05418719
#> X282  1.040527e-01 0.03694581
#> X283 -1.681657e-02 0.72167488
#> X284  3.590621e-02 0.15024631
#> X285  4.935448e-03 0.43596059
#> X286 -1.784424e-02 0.72906404
#> X287 -4.414967e-02 0.88669951
#> X288 -4.293871e-03 0.55665025
#> X289 -1.767163e-02 0.72660099
#> X290 -1.382614e-02 0.69211823
#> X291  2.528384e-02 0.18965517
#> X292 -1.623766e-01 0.98768473
#> X293  9.720141e-02 0.04187192
#> X294  3.041171e-02 0.16009852
#> X295  1.954905e-02 0.25615764
#> X296 -3.042245e-02 0.84236453
#> X297  3.655570e-03 0.45073892
#> X298  2.953934e-02 0.16256158
#> X299  5.134875e-03 0.43596059
#> X300 -6.142343e-04 0.50738916
#> X301 -4.255577e-02 0.87684729
#> X302 -1.841437e-02 0.74137931
#> X303 -4.276292e-02 0.88177340
#> X304  1.178889e-02 0.34729064
#> X305  1.939532e-02 0.25615764
#> X306  5.055966e-02 0.09605911
#> X307  3.354415e-02 0.15517241
#> X308 -5.931137e-02 0.92610837
#> X309  2.859233e-02 0.16256158
#> X310  7.068375e-02 0.06157635
#> X311 -1.000000e-03 0.51231527
#> X312 -8.234139e-03 0.60344828
#> X313  2.130381e-02 0.22906404
#> X314  1.157129e-02 0.34729064
#> X315 -2.015054e-01 0.99507389
#> X316 -9.830769e-03 0.62315271
#> X317 -4.628215e-03 0.56157635
#> X318  1.928819e-02 0.25615764
#> X319  3.067678e-02 0.15517241
#> X320 -7.019580e-03 0.59359606
#> X321  5.840995e-03 0.42610837
#> X322 -1.143434e-01 0.97044335
#> X323 -7.051494e-03 0.59852217
#> X324  9.777778e-03 0.38177340
#> X325  5.092186e-02 0.09605911
#> X326  9.277318e-03 0.38916256
#> X327  7.079385e-02 0.06157635
#> X328  1.954578e-02 0.25615764
#> X329 -1.487584e-02 0.70689655
#> X330 -1.147405e-02 0.65270936
#> X331  1.877604e-02 0.25615764
#> X332 -1.968014e-02 0.74630542
#> X333 -4.257783e-02 0.87931034
#> X334  3.953032e-03 0.44581281
#> X335  1.301856e-02 0.32758621
#> X336 -6.585276e-02 0.93349754
#> X337 -2.093404e-02 0.76600985
#> X338  1.927842e-02 0.25615764
#> X339  4.322635e-03 0.44334975
#> X340 -9.662513e-03 0.61822660
#> X341 -1.521582e-02 0.71182266
#> X342 -6.864437e-03 0.59113300
#> X343 -1.239048e-02 0.66256158
#> X344  3.952405e-02 0.13054187
#> X345  2.012902e-02 0.25123153
#> X346  8.465689e-02 0.04926108
#> X347  1.223348e-02 0.34236453
#> X348  8.316714e-02 0.04926108
#> X349 -1.420774e-02 0.69704433
#> X350 -3.047236e-02 0.84482759
#> X351  3.163784e-03 0.45320197
#> X352  1.243370e-04 0.49753695
#> X353  2.340897e-02 0.20935961
#> X354  9.006385e-02 0.04433498
#> X355  1.707674e-02 0.27832512
#> X356 -1.567755e-02 0.71428571
#> X357  8.513324e-02 0.04926108
#> X358  5.133077e-02 0.09605911
#> X359  2.558176e-03 0.46059113
#> X360 -5.994237e-03 0.58128079
#> X361  9.802151e-03 0.37931034
#> X362 -7.336184e-02 0.94088670
#> X363 -5.925476e-02 0.92364532
#> X364  4.706680e-03 0.43842365
#> X365 -9.783925e-03 0.62068966
#> X366 -5.647059e-04 0.50492611
#> X367  3.255681e-02 0.15517241
#> X368  7.945171e-04 0.49261084
#> X369  1.956667e-02 0.25615764
#> X370  1.446055e-02 0.29802956
#> X371  2.098561e-02 0.23399015
#> X372 -1.099254e-01 0.96551724
#> X373  1.002560e-03 0.48768473
#> X374 -1.792585e-02 0.73152709
#> X375 -3.780207e-03 0.55172414
#> X376 -1.220984e-02 0.65763547
#> X377 -3.655382e-02 0.85221675
#> X378 -1.460982e-03 0.52463054
#> X379  1.838095e-02 0.26354680
#> X380 -5.036558e-02 0.90394089
#> X381 -4.013598e-02 0.87192118
#> X382 -5.694087e-03 0.57142857
#> X383  3.317367e-02 0.15517241
#> X384  1.652300e-02 0.28325123
#> X385 -4.330475e-03 0.55911330
#> X386 -2.674392e-02 0.83004926
#> X387 -8.978830e-02 0.95566502
#> X388  4.188631e-02 0.12561576
#> X389 -3.884853e-02 0.86699507
#> X390 -1.409821e-01 0.98029557
#> X391  3.050039e-02 0.15517241
#> X392 -9.844257e-02 0.96059113
#> X393  6.201061e-02 0.07142857
#> X394  2.941972e-03 0.45566502
#> X395 -1.334444e-02 0.67980296
#> X396  7.059864e-02 0.06157635
#> X397  9.691541e-03 0.38177340
#> X398 -1.440213e-02 0.70197044
#> X399  2.929370e-02 0.16256158
#> X400 -1.981584e-02 0.74876847

## Permutation p-values 
if (FALSE) { # \dontrun{
rf.iris <- ranger(Species ~ ., data = iris, importance = 'permutation')
importance_pvalues(rf.iris, method = "altmann", formula = Species ~ ., data = iris)
} # }
```
